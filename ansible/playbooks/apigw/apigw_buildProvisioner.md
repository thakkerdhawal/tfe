# apigw_buildProvisioner.yml

Ansible playbook to bulid API Gateway after the instance is provisioned

## Overview

This playbook is designed to run after an API Gateway EC2 instance is provisioned, and needs to be configured for the first time.

## Prerequisites

1. Consul access token is required to read KV. It can either be defined in environment var **CONSUL_HTTP_TOKEN** or pass into the playbook as extra var **consulTokenPassword**

## Variables Used

The following vars must be passed into the playook as extra vars:
- awsEnv: target environment
- awsRegion: target AWS region

The following vars are optional depends on the use cases:
- apigwUser: the user to be updated. Default to ssgconfig
- apigwPassword: the password you would like to set. Default to the initial password stored in Consul. 

The following vars are required by the roles and have been defined as groups_var for apigw host group. They can be passed into the playbook as extra vars to overwrite default values:
- apigwMgmtEndpoint: default to "https://localhost:8443"

## Getting Started

Example 1: (DEV) build the gateway with initial password generated by Terraform
```
$ export CONSUL_HTTP_TOKEN=XXXX
ansible-playbook playbooks/apigw/apigw_buildProvisioner.yml -e 'awsEnv=lab awsRegion=eu-west-1'
```

Example 2: (NonProd/Prod) build the gateway with passowrd we provide
```
$ export CONSUL_HTTP_TOKEN=XXXX
ansible-playbook playbooks/apigw/apigw_buildProvisioner.yml -e 'awsEnv=lab awsRegion=eu-west-1 apigwPassword=XXXX'
```

